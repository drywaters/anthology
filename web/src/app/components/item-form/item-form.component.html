<form [formGroup]="form" (ngSubmit)="submit()" class="item-form" novalidate>
    <mat-form-field appearance="fill">
        <mat-label>Title</mat-label>
        <input matInput formControlName="title" maxlength="120" required />
        @if (form.get('title')?.hasError('required')) {
            <mat-error>Title is required.</mat-error>
        }
        @if (form.get('title')?.hasError('maxlength')) {
            <mat-error>Keep titles under 120 characters.</mat-error>
        }
    </mat-form-field>

    <mat-form-field appearance="fill">
        <mat-label>Creator</mat-label>
        <input matInput formControlName="creator" maxlength="120" />
        <mat-hint>Author, developer, or primary artist.</mat-hint>
    </mat-form-field>

    <mat-form-field appearance="fill">
        <mat-label>Type</mat-label>
        <mat-select formControlName="itemType" required>
            @for (option of itemTypeOptions; track option) {
                <mat-option [value]="option[0]">
                    {{ option[1] }}
                </mat-option>
            }
        </mat-select>
    </mat-form-field>

    <mat-form-field appearance="fill">
        <mat-label>Release year</mat-label>
        <input matInput formControlName="releaseYear" type="number" min="0" />
        <button
            mat-icon-button
            matSuffix
            type="button"
            (click)="clearReleaseYear()"
            aria-label="Clear release year"
        >
            <mat-icon>close</mat-icon>
        </button>
    </mat-form-field>

    @if (isBook) {
        <app-book-details
            [form]="form"
            [bookStatusOptions]="bookStatusOptions"
            [formatOptions]="formatOptions"
            [genreOptions]="genreOptions"
            [hasSeriesData]="hasSeriesData"
        />
    }

    @if (isGame) {
        <app-game-details [form]="form" />
    }

    <app-cover-section
        [form]="form"
        [coverImageError]="coverImageError"
        (coverErrorSet)="onCoverErrorSet($event)"
        (coverErrorCleared)="onCoverErrorCleared()"
    />

    <mat-form-field appearance="fill">
        <mat-label>Notes</mat-label>
        <textarea matInput rows="4" formControlName="notes" maxlength="500"></textarea>
        <mat-hint align="end">{{ form.get('notes')?.value?.length || 0 }}/500</mat-hint>
    </mat-form-field>

    <div class="form-actions">
        @if (mode === 'edit') {
            <button
                mat-flat-button
                type="button"
                class="form-actions__delete"
                (click)="deleteRequested.emit()"
                [disabled]="busy || resyncing"
            >
                Delete item
            </button>
        }
        @if (mode === 'edit' && isBook) {
            <button
                mat-stroked-button
                type="button"
                (click)="requestResync()"
                [disabled]="busy || resyncing"
            >
                {{ resyncing ? 'Syncing...' : 'Re-sync' }}
            </button>
        }
        <button
            mat-stroked-button
            type="button"
            (click)="cancelled.emit()"
            [disabled]="busy || resyncing"
        >
            Cancel
        </button>
        <button mat-flat-button color="primary" type="submit" [disabled]="busy || resyncing">
            {{ mode === 'create' ? 'Add to collection' : 'Save changes' }}
        </button>
    </div>
</form>
