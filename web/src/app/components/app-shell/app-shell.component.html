<div class="app-shell" [class.is-mobile]="isMobile()" [class.subpanel-open]="subpanelVisible()" [class.sidebar-open]="sidebarOpen()">
  <header class="mobile-header" *ngIf="isMobile()">
    <button type="button" class="icon-button" (click)="toggleSidebar()" aria-label="Toggle navigation drawer">
      <mat-icon>{{ sidebarOpen() ? 'close' : 'menu' }}</mat-icon>
    </button>
    <span class="mobile-title">Anthology</span>
  </header>

  <button
    *ngIf="!isMobile()"
    class="sidebar-toggle icon-button"
    type="button"
    [class.collapsed]="!sidebarOpen()"
    (click)="toggleSidebar()"
    [attr.aria-label]="sidebarOpen() ? 'Collapse navigation' : 'Expand navigation'"
  >
    <mat-icon>{{ sidebarOpen() ? 'chevron_left' : 'chevron_right' }}</mat-icon>
  </button>

  <div class="sidebar-container" [class.open]="sidebarOpen()" [class.drawer]="isMobile()">
    <app-sidebar
      class="sidebar"
      [activeSection]="currentSection()"
      [sections]="sections"
      (selectSection)="handleSelectSection($event)"
    ></app-sidebar>
  </div>

  <div
    class="subpanel-container"
    *ngIf="subpanelVisible()"
    [class.open]="subpanelVisible()"
    [class.mobile]="isMobile()"
  >
    <app-subpanel
      [section]="currentSection()"
      [actions]="panelActions(activePanel())"
      [links]="panelLinks(activePanel())"
      (back)="handleBack()"
      (actionTriggered)="handleActionTriggered($event)"
      (linkSelected)="handleLinkSelected($event)"
    ></app-subpanel>
  </div>

  <div class="content" [class.dimmed]="subpanelVisible() && !isMobile()">
    <div class="content-inner">
      <router-outlet></router-outlet>
    </div>
  </div>

  <div class="scrim" *ngIf="isMobile() && sidebarOpen()" (click)="closeAllPanels()"></div>
</div>
