<div class="page">
    <app-items-filter-panel
        [typeFilter]="typeFilter"
        [statusFilter]="statusFilter"
        [shelfStatusFilter]="shelfStatusFilter"
        [showStatusFilter]="showStatusFilter"
        [viewMode]="viewMode"
        [typeOptions]="typeOptions"
        [statusOptions]="statusOptions"
        [shelfStatusOptions]="shelfStatusOptions"
        (typeFilterChange)="setTypeFilter($event)"
        (statusFilterChange)="setStatusFilter($event)"
        (shelfStatusFilterChange)="setShelfStatusFilter($event)"
        (viewModeChange)="setViewMode($event)"
    ></app-items-filter-panel>

    <div class="layout">
        <section class="items-panel" #scrollContainer>
            <mat-card>
                @if (loading()) {
                    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
                }

                @if (isSeriesView()) {
                    @if (hasSeriesData()) {
                        <app-items-series-view
                            [seriesData]="seriesData"
                            [expandedSeries]="expandedSeries"
                            (seriesToggled)="toggleSeriesExpanded($event)"
                            (itemSelected)="startEdit($event)"
                            (addMissingVolume)="addMissingVolume($event)"
                            (viewSeriesDetail)="viewSeriesDetail($event)"
                        ></app-items-series-view>
                    } @else {
                        <app-items-empty-state
                            [isUnfiltered]="isUnfiltered"
                            [loading]="loading"
                            (createRequested)="startCreate()"
                        ></app-items-empty-state>
                    }
                } @else {
                    @if (hasFilteredItems()) {
                        @if (isGridView()) {
                            <app-items-grid-view
                                [groupedItems]="groupedItems"
                                (itemSelected)="startEdit($event)"
                                (shelfLocationRequested)="viewShelfPlacementFromChild($event)"
                                (seriesRequested)="viewSeriesFromChild($event)"
                            ></app-items-grid-view>
                        } @else {
                            <app-items-table-view
                                [groupedItems]="groupedItems"
                                [typeFilter]="typeFilter"
                                [displayedColumns]="displayedColumns"
                                (itemSelected)="startEdit($event)"
                                (shelfLocationRequested)="viewShelfPlacementFromChild($event)"
                                (typeFilterRequested)="filterByType($event)"
                                (seriesRequested)="viewSeriesFromChild($event)"
                            ></app-items-table-view>
                        }
                    } @else {
                        <app-items-empty-state
                            [isUnfiltered]="isUnfiltered"
                            [loading]="loading"
                            (createRequested)="startCreate()"
                        ></app-items-empty-state>
                    }
                }
            </mat-card>
        </section>

        <app-alpha-rail
            [histogram]="histogram"
            [activeLetter]="activeLetter"
            [style.top.px]="alphaRailTop()"
            [style.--alpha-rail-max-height]="alphaRailMaxHeight()"
            (letterSelected)="onLetterSelected($event)"
        ></app-alpha-rail>
    </div>
</div>
