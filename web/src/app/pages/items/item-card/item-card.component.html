<article
    class="item-card"
    tabindex="0"
    (click)="onCardClick()"
    (keydown)="handleCardKeydown($event)"
>
    <div class="card-cover" [class.card-cover--empty]="!item.coverImage">
        @if (item.coverImage) {
            <img [src]="item.coverImage | thumbnail" [alt]="item.title + ' cover'" loading="lazy" />
        }
        @if (!item.coverImage) {
            <div class="card-cover-placeholder">
                <mat-icon aria-hidden="true">book</mat-icon>
                <span>Tap to edit</span>
            </div>
        }
    </div>
    <div class="card-body">
        <div class="card-title-row">
            <h4>{{ item.title }}</h4>
            <span class="card-chip item-type-chip" [ngClass]="chipClassFor(item)">
                {{ labelFor(item) }}
            </span>
        </div>
        <p class="card-meta">
            {{ item.creator || 'Unknown creator' }}
        </p>
        @if (item.releaseYear) {
            <p class="card-sub">Released {{ item.releaseYear }}</p>
        }
        @if (item.shelfPlacement || item.seriesName) {
            <div class="card-actions">
                @if (item.shelfPlacement) {
                    <button
                        type="button"
                        mat-icon-button
                        class="shelf-location-button shelf-location-button--card"
                        (click)="onShelfLocationClick($event)"
                        [attr.aria-label]="
                            'View shelf slot ' +
                            (item.shelfPlacement.rowIndex + 1) +
                            '/' +
                            (item.shelfPlacement.colIndex + 1) +
                            ' on ' +
                            item.shelfPlacement.shelfName
                        "
                    >
                        <mat-icon aria-hidden="true">visibility</mat-icon>
                    </button>
                }
                @if (item.seriesName) {
                    <button
                        type="button"
                        mat-icon-button
                        class="series-button series-button--card"
                        (click)="onSeriesClick($event)"
                        [attr.aria-label]="'View series: ' + item.seriesName"
                    >
                        <mat-icon aria-hidden="true">collections_bookmark</mat-icon>
                    </button>
                }
            </div>
        }
        @if (readingStatusLabel(item); as statusLabel) {
            <p class="card-sub">
                <span class="status-chip">{{ statusLabel }}</span>
                @if (item.readingStatus === BookStatus.Read && item.readAt) {
                    • Read {{ item.readAt | date: 'mediumDate' }}
                }
                @if (readingProgress(item); as progress) {
                    •
                    @if (progress.percent !== undefined) {
                        {{ progress.percent }}% complete ({{ progress.current }}/{{
                            progress.total
                        }}
                        pages)
                    } @else {
                        On page {{ progress.current }}
                    }
                }
            </p>
        }
    </div>
</article>
