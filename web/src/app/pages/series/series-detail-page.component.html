<div class="page">
    <mat-progress-bar *ngIf="loading()" mode="indeterminate"></mat-progress-bar>

    <ng-container *ngIf="series() as s">
        <header class="page-header">
            <button mat-icon-button type="button" (click)="goBack()" aria-label="Go back">
                <mat-icon>arrow_back</mat-icon>
            </button>
            <div class="header-content">
                <h1>{{ s.seriesName }}</h1>
                <div class="header-actions">
                    <button
                        mat-icon-button
                        type="button"
                        (click)="openEditDialog()"
                        [disabled]="busy()"
                        aria-label="Edit series"
                    >
                        <mat-icon>edit</mat-icon>
                    </button>
                    <button
                        mat-icon-button
                        type="button"
                        class="delete-button"
                        (click)="openDeleteDialog()"
                        [disabled]="busy()"
                        aria-label="Delete series"
                    >
                        <mat-icon>delete</mat-icon>
                    </button>
                </div>
                <mat-chip [ngClass]="getStatusClass(s.status)">
                    {{ getStatusLabel(s.status) }}
                </mat-chip>
            </div>
        </header>

        <div class="content">
            <mat-card class="summary-card">
                <mat-card-header>
                    <mat-card-title>Series Summary</mat-card-title>
                </mat-card-header>
                <mat-card-content>
                    <div class="summary-stats">
                        <div class="stat">
                            <span class="stat-value">{{ s.ownedCount }}</span>
                            <span class="stat-label">Owned</span>
                        </div>
                        <div
                            class="stat"
                            *ngIf="s.missingCount !== null && s.missingCount !== undefined"
                        >
                            <span class="stat-value missing">{{ s.missingCount }}</span>
                            <span class="stat-label">Missing</span>
                        </div>
                        <div
                            class="stat"
                            *ngIf="s.totalVolumes !== null && s.totalVolumes !== undefined"
                        >
                            <span class="stat-value">{{ s.totalVolumes }}</span>
                            <span class="stat-label">Total Volumes</span>
                        </div>
                    </div>
                </mat-card-content>
            </mat-card>

            <section class="owned-section" *ngIf="s.items && s.items.length > 0">
                <h2>Owned Volumes</h2>
                <div class="items-grid">
                    <app-item-card
                        *ngFor="let item of s.items; trackBy: trackById"
                        [item]="item"
                        (click)="editItem(item)"
                    ></app-item-card>
                </div>
            </section>

            <section
                class="missing-section"
                *ngIf="s.missingVolumes && s.missingVolumes.length > 0"
            >
                <h2>Missing Volumes</h2>
                <div class="missing-grid">
                    <div
                        class="missing-volume-card"
                        *ngFor="let volume of s.missingVolumes; trackBy: trackByVolume"
                    >
                        <div class="missing-volume-content">
                            <span class="volume-label">Volume {{ volume }}</span>
                            <span class="missing-label">Not in collection</span>
                        </div>
                        <button
                            mat-flat-button
                            color="primary"
                            type="button"
                            (click)="addMissingVolume(volume)"
                        >
                            <mat-icon>add</mat-icon>
                            Add to Collection
                        </button>
                    </div>
                </div>
            </section>
        </div>
    </ng-container>

    <div class="empty-state" *ngIf="!loading() && !series()">
        <mat-icon>search_off</mat-icon>
        <p>Series not found</p>
        <button mat-stroked-button type="button" (click)="goBack()">Back to Library</button>
    </div>
</div>
